<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_077aom6" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.6.0">
  <bpmn:process id="Compensation_Demo" name="Compensation Demo" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>SequenceFlow_162zyw6</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_162zyw6" sourceRef="StartEvent_1" targetRef="ExclusiveGateway_12br1g3" />
    <bpmn:parallelGateway id="ExclusiveGateway_12br1g3">
      <bpmn:incoming>SequenceFlow_162zyw6</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0n2swo5</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0f98kw6</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:subProcess id="SubProcess_1lwvk0y">
      <bpmn:incoming>SequenceFlow_0n2swo5</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0xz0z3a</bpmn:outgoing>
      <bpmn:startEvent id="StartEvent_1i9r33u">
        <bpmn:outgoing>SequenceFlow_0iyt4cg</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:sequenceFlow id="SequenceFlow_0iyt4cg" sourceRef="StartEvent_1i9r33u" targetRef="Task_bookHotel" />
      <bpmn:scriptTask id="Task_bookHotel" name="Book Hotel" scriptFormat="Javascript">
        <bpmn:incoming>SequenceFlow_0iyt4cg</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_0408j1y</bpmn:outgoing>
        <bpmn:script>execution.setVariable("bookingstatus","booked");</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:boundaryEvent id="Catch_CancelReservation_Event" attachedToRef="Task_bookHotel">
        <bpmn:compensateEventDefinition id="CompensateEventDefinition_1cyskbx" />
      </bpmn:boundaryEvent>
      <bpmn:scriptTask id="Task_CancelBooking" name="Cancel booking" isForCompensation="true" scriptFormat="Javascript">
        <bpmn:script>execution.setVariable("bookingstatus","cancelled");</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:sequenceFlow id="SequenceFlow_0408j1y" sourceRef="Task_bookHotel" targetRef="Task_ReviewBooking" />
      <bpmn:userTask id="Task_ReviewBooking" name="Review booking" camunda:assignee="demo">
        <bpmn:incoming>SequenceFlow_0408j1y</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_0wstrv5</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:endEvent id="EndEvent_0c4zwy2">
        <bpmn:incoming>SequenceFlow_1l5p90y</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="SequenceFlow_0wstrv5" sourceRef="Task_ReviewBooking" targetRef="Task_updateReviewedStatus" />
      <bpmn:sequenceFlow id="SequenceFlow_1l5p90y" sourceRef="Task_updateReviewedStatus" targetRef="EndEvent_0c4zwy2" />
      <bpmn:scriptTask id="Task_updateReviewedStatus" name="Update review status" scriptFormat="Javascript">
        <bpmn:incoming>SequenceFlow_0wstrv5</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_1l5p90y</bpmn:outgoing>
        <bpmn:script>execution.setVariable("bookingreviewstatus","reviewed");</bpmn:script>
      </bpmn:scriptTask>
      <bpmn:association id="Association_0p2fsmb" associationDirection="One" sourceRef="Catch_CancelReservation_Event" targetRef="Task_CancelBooking" />
    </bpmn:subProcess>
    <bpmn:sequenceFlow id="SequenceFlow_0n2swo5" sourceRef="ExclusiveGateway_12br1g3" targetRef="SubProcess_1lwvk0y" />
    <bpmn:scriptTask id="Task_ChargeCard" name="Charge Credit card" scriptFormat="Javascript">
      <bpmn:incoming>SequenceFlow_0uwvgeg</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_00nrgxb</bpmn:outgoing>
      <bpmn:script>var inp=execution.getVariable("scenario")

if (inp=="invcrd")
 throw new org.camunda.bpm.engine.delegate.BpmnError("Invalid card number");

execution.setVariable("cardchargestatus","success");</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:endEvent id="EndEvent_0hbba6s">
      <bpmn:incoming>SequenceFlow_00nrgxb</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_160w3g3</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0xz0z3a</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_00nrgxb" sourceRef="Task_ChargeCard" targetRef="EndEvent_0hbba6s" />
    <bpmn:boundaryEvent id="IntermediateThrowEvent_13vdz34" attachedToRef="Task_ChargeCard">
      <bpmn:outgoing>SequenceFlow_0ybhp4f</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_1jb72wz" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0ybhp4f" sourceRef="IntermediateThrowEvent_13vdz34" targetRef="Task_CardChargeError" />
    <bpmn:intermediateThrowEvent id="Throw_CancelReservation_Event" name="Cancel reservation">
      <bpmn:incoming>SequenceFlow_1292eb1</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_160w3g3</bpmn:outgoing>
      <bpmn:compensateEventDefinition id="CompensateEventDefinition_0cj33jq" />
    </bpmn:intermediateThrowEvent>
    <bpmn:sequenceFlow id="SequenceFlow_160w3g3" sourceRef="Throw_CancelReservation_Event" targetRef="EndEvent_0hbba6s" />
    <bpmn:sequenceFlow id="SequenceFlow_0xz0z3a" sourceRef="SubProcess_1lwvk0y" targetRef="EndEvent_0hbba6s" />
    <bpmn:sequenceFlow id="SequenceFlow_0f98kw6" sourceRef="ExclusiveGateway_12br1g3" targetRef="Waitfor20Sec" />
    <bpmn:sequenceFlow id="SequenceFlow_0uwvgeg" sourceRef="Waitfor20Sec" targetRef="Task_ChargeCard" />
    <bpmn:intermediateCatchEvent id="Waitfor20Sec" name="Simulate 20 sec delay">
      <bpmn:incoming>SequenceFlow_0f98kw6</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0uwvgeg</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_01o8qjj">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT20S</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1292eb1" sourceRef="Task_CardChargeError" targetRef="Throw_CancelReservation_Event" />
    <bpmn:scriptTask id="Task_CardChargeError" name="Card charge failed" scriptFormat="Javascript">
      <bpmn:incoming>SequenceFlow_0ybhp4f</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1292eb1</bpmn:outgoing>
      <bpmn:script>execution.setVariable("cardchargestatus","Error");</bpmn:script>
    </bpmn:scriptTask>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Compensation_Demo">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="172" y="322" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_162zyw6_di" bpmnElement="SequenceFlow_162zyw6">
        <di:waypoint x="208" y="340" />
        <di:waypoint x="305" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ParallelGateway_1y45p3a_di" bpmnElement="ExclusiveGateway_12br1g3">
        <dc:Bounds x="305" y="315" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SubProcess_1lwvk0y_di" bpmnElement="SubProcess_1lwvk0y" isExpanded="true">
        <dc:Bounds x="470" y="80" width="650" height="320" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_1i9r33u_di" bpmnElement="StartEvent_1i9r33u">
        <dc:Bounds x="510" y="162" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0n2swo5_di" bpmnElement="SequenceFlow_0n2swo5">
        <di:waypoint x="330" y="315" />
        <di:waypoint x="330" y="200" />
        <di:waypoint x="470" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_1gzfz9g_di" bpmnElement="Task_ChargeCard">
        <dc:Bounds x="550" y="580" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0hbba6s_di" bpmnElement="EndEvent_0hbba6s">
        <dc:Bounds x="1272" y="452" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_00nrgxb_di" bpmnElement="SequenceFlow_00nrgxb">
        <di:waypoint x="650" y="620" />
        <di:waypoint x="1290" y="620" />
        <di:waypoint x="1290" y="488" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BoundaryEvent_09oxbg8_di" bpmnElement="IntermediateThrowEvent_13vdz34">
        <dc:Bounds x="632" y="642" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0ybhp4f_di" bpmnElement="SequenceFlow_0ybhp4f">
        <di:waypoint x="650" y="678" />
        <di:waypoint x="650" y="750" />
        <di:waypoint x="730" y="750" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="IntermediateThrowEvent_1detbth_di" bpmnElement="Throw_CancelReservation_Event">
        <dc:Bounds x="952" y="732" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="943" y="775" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_160w3g3_di" bpmnElement="SequenceFlow_160w3g3">
        <di:waypoint x="988" y="750" />
        <di:waypoint x="1290" y="750" />
        <di:waypoint x="1290" y="488" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0xz0z3a_di" bpmnElement="SequenceFlow_0xz0z3a">
        <di:waypoint x="1120" y="240" />
        <di:waypoint x="1290" y="240" />
        <di:waypoint x="1290" y="452" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0iyt4cg_di" bpmnElement="SequenceFlow_0iyt4cg">
        <di:waypoint x="546" y="180" />
        <di:waypoint x="600" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_0kumrxt_di" bpmnElement="Task_bookHotel">
        <dc:Bounds x="600" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_1iq7k95_di" bpmnElement="Catch_CancelReservation_Event">
        <dc:Bounds x="682" y="202" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_0p2fsmb_di" bpmnElement="Association_0p2fsmb">
        <di:waypoint x="700" y="238" />
        <di:waypoint x="700" y="300" />
        <di:waypoint x="770" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_1hx0g0k_di" bpmnElement="Task_CancelBooking">
        <dc:Bounds x="770" y="260" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0408j1y_di" bpmnElement="SequenceFlow_0408j1y">
        <di:waypoint x="700" y="180" />
        <di:waypoint x="760" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_05m4406_di" bpmnElement="Task_ReviewBooking">
        <dc:Bounds x="760" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0c4zwy2_di" bpmnElement="EndEvent_0c4zwy2">
        <dc:Bounds x="1022" y="162" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0wstrv5_di" bpmnElement="SequenceFlow_0wstrv5">
        <di:waypoint x="860" y="180" />
        <di:waypoint x="900" y="180" />
        <di:waypoint x="900" y="290" />
        <di:waypoint x="930" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1l5p90y_di" bpmnElement="SequenceFlow_1l5p90y">
        <di:waypoint x="980" y="250" />
        <di:waypoint x="980" y="224" />
        <di:waypoint x="1040" y="224" />
        <di:waypoint x="1040" y="198" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_0kiemh4_di" bpmnElement="Task_updateReviewedStatus">
        <dc:Bounds x="930" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0f98kw6_di" bpmnElement="SequenceFlow_0f98kw6">
        <di:waypoint x="330" y="365" />
        <di:waypoint x="330" y="602" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0uwvgeg_di" bpmnElement="SequenceFlow_0uwvgeg">
        <di:waypoint x="348" y="620" />
        <di:waypoint x="550" y="620" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="IntermediateCatchEvent_0w47ybm_di" bpmnElement="Waitfor20Sec">
        <dc:Bounds x="312" y="602" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="291" y="645" width="79" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1292eb1_di" bpmnElement="SequenceFlow_1292eb1">
        <di:waypoint x="830" y="750" />
        <di:waypoint x="952" y="750" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_0hocmy4_di" bpmnElement="Task_CardChargeError">
        <dc:Bounds x="730" y="710" width="100" height="80" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
